---
minio:
  enabled: true
  persistence:
    enabled: true
    storage-class: local-path
    size: 10Gi

image:
  registry: "k3d-grafana:45629"
  repository: "enterprise-logs"
  tag: "v1.2.0"
  pullPolicy: Always

loki:
  podAnnotations:
    prometheus.io/scrape: "true"
    prometheus.io/port: "3100"
  config: |
    auth_enabled: false
    auth:
      type: trust

    server:
      http_listen_port: 3100

    memberlist:
      join_members:
        - {{ include "loki.fullname" . }}-memberlist

    common:
      path_prefix: /var/loki
      replication_factor: 1
      ring:
        kvstore:
          store: memberlist
      storage:
        s3:
          endpoint: minio.minio.svc.cluster.local:9000
          insecure: true
          bucketnames: loki-data
          access_key_id: loki
          secret_access_key: supersecret
          s3forcepathstyle: true

    schema_config:
      configs:
        - from: "2020-09-07"
          store: boltdb-shipper
          object_store: s3
          schema: v11
          index:
            period: 24h
            prefix: loki_index_

    frontend_worker:
      frontend_address: {{ include "loki.queryFrontendFullname" . }}:9095

    frontend:
      log_queries_longer_than: 5s
      compress_responses: true
      tail_proxy_url: http://{{ include "loki.querierFullname" . }}:3100

ingester:
  persistence:
    enabled: true
    storageClass: local-path
  extraEnv:
    - name: JAEGER_AGENT_HOST
      value: "jaeger-agent.jaeger.svc.cluster.local"
    - name: JAEGER_AGENT_PORT
      value: "6831"
    - name: JAEGER_TAGS
      value: "app=loki"
    - name: JAEGER_SAMPLER_TYPE
      value: "const"
    - name: JAEGER_SAMPLER_PARAM
      value: "1"

distributor:
  extraEnv:
    - name: JAEGER_AGENT_HOST
      value: "jaeger-agent.jaeger.svc.cluster.local"
    - name: JAEGER_AGENT_PORT
      value: "6831"
    - name: JAEGER_TAGS
      value: "app=loki"
    - name: JAEGER_SAMPLER_TYPE
      value: "const"
    - name: JAEGER_SAMPLER_PARAM
      value: "1"

querier:
  extraEnv:
    - name: JAEGER_AGENT_HOST
      value: "jaeger-agent.jaeger.svc.cluster.local"
    - name: JAEGER_AGENT_PORT
      value: "6831"
    - name: JAEGER_TAGS
      value: "app=loki"
    - name: JAEGER_SAMPLER_TYPE
      value: "const"
    - name: JAEGER_SAMPLER_PARAM
      value: "1"

queryFrontend:
  extraEnv:
    - name: JAEGER_AGENT_HOST
      value: "jaeger-agent.jaeger.svc.cluster.local"
    - name: JAEGER_AGENT_PORT
      value: "6831"
    - name: JAEGER_TAGS
      value: "app=loki"
    - name: JAEGER_SAMPLER_TYPE
      value: "const"
    - name: JAEGER_SAMPLER_PARAM
      value: "1"
